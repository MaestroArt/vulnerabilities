<?php

namespace App\Http\Controllers;

use App\Http\Requests\VulnerablityRequest;
use App\Models\Vulnerability;
use App\Repositories\VulnerabilityRepository;

class VulnerabilityController extends Controller
{
    public function index(VulnerabilityRepository $vulnerabilityRepository)
    {
        $vulnerabilities = $vulnerabilityRepository->getVulnerabilitiesList([
            'id', 'name', 'slug', 'user_id', 'created_at'
        ]);

        return view('vulnerability.index', compact('vulnerabilities'));
    }

    public function create()
    {
        $saveLink = route('vulnerability.store');

        return view('vulnerability.edit', compact('saveLink'));
    }

    public function store(VulnerablityRequest $request, VulnerabilityRepository $vulnerabilityRepository)
    {
        $data = $request->only(
            array_keys($request->rules())
        );

        $vulnerabilityRepository->createVulnerability($data);

        return redirect()->route('home');
    }

    public function show(Vulnerability $vulnerability)
    {
        $vulnerability->load('user:id,name');

        return view('vulnerability.show', compact('vulnerability'));
    }

    public function edit(Vulnerability $vulnerability)
    {
        $saveLink = route('vulnerability.update', $vulnerability->id);

        return view('vulnerability.edit', compact('vulnerability', 'saveLink'));
    }

    public function update(VulnerablityRequest $request, Vulnerability $vulnerability)
    {
        $data = $request->only(
            array_keys($request->rules())
        );

        $vulnerability->update($data);

        return redirect()->route('home');
    }

    public function destroy(Vulnerability $vulnerability)
    {
        $vulnerability->delete();

        return redirect()->route('home');
    }
}
